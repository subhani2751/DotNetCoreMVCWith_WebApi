function logout(){localStorage.removeItem("jwt");$.ajax({url:"/Employee/Login?partialviewneed=1",type:"GET",success:function(n){$(".containermain").html(n)},error:function(){alert("Access denied or not authorized")}})}async function parseJwtandGetTokenTime(){const n=await localStorage.getItem("jwt");let t=0;if(n){const i=n.split(".")[1],r=i.replace(/-/g,"+").replace(/_/g,"/"),u=decodeURIComponent(atob(r).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")),f=JSON.parse(u);t=f.exp}return t}async function startInactivityTimer(){const n=localStorage.getItem("jwt");if(n){clearTimeout(logoutTimer);let n=await parseJwtandGetTokenTime();n=n*1e3-(new Date).getTime();logoutTimer=setTimeout(()=>{logout()},n)}}async function resetInactivityTimerAndRefreshToken(){const n=localStorage.getItem("jwt");if(n){let t=await parseJwtandGetTokenTime();t=t*1e3-(new Date).getTime();t<=36e5&&$.ajax({url:"/api/ApiEmployee/RefreshToken",type:"POST",contentType:"application/json",headers:{Authorization:"Bearer "+n},success:function(n){n.token&&(localStorage.setItem("jwt",n.token),startInactivityTimer())},error:function(){console.log("Failed to refresh token.")}})}}function removeJWT(){localStorage.removeItem("jwt")}function updatePaginationUI(){totalPages=Math.ceil(totalRecords/pagesize);$("#currentPageText").text(pagenumber);$("#totalPagesText").text(totalPages);$(".prevPage").prop("disabled",pagenumber===1);$(".nextPage").prop("disabled",pagenumber===totalPages||totalPages===0)}function LoadTable(){const n="/api/ApiEmployee/getTablePageData?pagesize="+pagesize+"&pagenumber="+pagenumber;console.log(n);$.ajax({url:n,type:"GET",contentType:"application/json",success:function(n){$("#employeeTableBody").empty();var t=$("#employeeTableBody"),i=n.lstEmployees;totalRecords=n.totalRecords;$.each(i,function(n,i){var r=`<tr id="row_${i.employeeId}">
                                        <td><input type="checkbox" class="rowCheckbox" data-id="${i.employeeId}"></td>
                                        <td>${i.employeeId}</td>
                                        <td>${i.firstName}</td>
                                        <td>${i.lastName}</td>
                                        <td>${i.email}</td>
                                        <td>${i.department}</td>
                                        <td>${i.hireDate?i.hireDate.split("T")[0]:""}</td>
                                        <td>${i.salary}</td>
                                        <td>
                                            <button class="btn btn-success btn-sm Edit" data-id="${i.employeeId}">Edit</button>
                                            <button class="btn btn-danger btn-sm deleteRow" data-id="${i.employeeId}">Delete</button>
                                        </td>
                                    </tr>`;t.append(r)});updatePaginationUI()},Error:function(n){console.log(n)}})}$.validator.addMethod("salaryRange",function(n,t){return this.optional(t)||new RegExp("^\\d+(\\.\\d{1,2})?$").test(n)},"Enter a valid salary (numbers and up to 2 decimal places only)");$.validator.addMethod("EmailFormate",function(n,t){return this.optional(t)||new RegExp("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$").test(n)},"Enter a valid Email only");$.validator.addMethod("AlphabelsFormate",function(n,t){return this.optional(t)||new RegExp("^[a-zA-Z\\s]+$").test(n)},"Accepts only alphabets and spaces");let logoutTimer;document.addEventListener("click",function(n){n.target.id!=="Logoutbtn"&&resetInactivityTimerAndRefreshToken()});$(document).on("click","#Logoutbtn",logout);window.onbeforeunload=removeJWT;window.onload=startInactivityTimer;$(document).on("click","#importExcel",function(){$("#excelFile").trigger("click")});$(document).on("change","#excelFile",function(){var t=this.files[0],n;t&&(n=new FormData,n.append("excelFile",t),$.ajax({url:"/api/ApiEmployee/ImportExcel",type:"POST",data:n,processData:!1,contentType:!1,success:function(n){n.success?($("#employeeTableBody").empty(),listEmployees(),alert("Excel file imported successfully!")):alert("Error importing Excel: "+n.message)},error:function(n){alert("Error importing Excel file: "+n.responseText)}}))});$(document).on("click",".export-option",function(){let n=$(this).data("format"),t=[];$(".rowCheckbox:checked").each(function(){t.push($(this).data("id"))});var i=t.join(",");if(t.length===0){alert("Please select at least one employee to export.");return}$.ajax({url:"/api/ApiEmployee/Export?format="+n+"&ids="+i,type:"POST",xhrFields:{responseType:"blob"},success:function(t,i,r){let e=r.getResponseHeader("Content-Disposition"),o=e?e.split("filename=")[1]:"SelectedEmployees.xlsx",f="";n==="Excel"?f="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":n==="CSV"?f="text/csv":n==="PDF"&&(f="application/pdf");let s=new Blob([t],{type:f}),u=document.createElement("a");u.href=window.URL.createObjectURL(s);u.download=o;document.body.appendChild(u);u.click();document.body.removeChild(u)},error:function(){alert("Error exporting file. Please try again.")}})});let pagesize=10,pagenumber=1,totalRecords=0,totalPages=1;$(document).on("change","#pageSize",function(){pagenumber=1;pagesize=$(this).val();LoadTable()});$(document).on("click",".prevPage",function(){pagenumber--;LoadTable()});$(document).on("click",".nextPage",function(){pagenumber++;LoadTable()});